cmake_minimum_required(VERSION 3.8)
cmake_policy(SET CMP0074 NEW) 
project(test LANGUAGES C CXX CUDA)
set(CMAKE_CXX_STANDARD 11)
set(SM_ARCH "sm_80")
set(CMAKE_CUDA_ARCHITECTURES "80")
set(CMAKE_CUDA_FLAGS "${CMAKE_CUDA_FLAGS} -arch=${SM_ARCH} -O3")
set(NCCL_DIR "/public/home/zhangxin/external-libraries/nccl/build")
set(BUILD_WITH_SHARED_NCCL 1)
set(NCCL_ROOT ${NCCL_DIR})
set(NCCL_INCLUDE_PATH ${NCCL_DIR}/include)
set(NCCL_INCLUDE_DIRS ${NCCL_DIR}/include)
set(NCCL_LIBRARIES ${NCCL_DIR}/lib)
set(CMAKE_PREFIX_PATH ${NCCL_DIR} ${CMAKE_PREFIX_PATH})
set(CMAKE_PREFIX_PATH . ${CMAKE_PREFIX_PATH})
include(GNUInstallDirs)
include_directories(${CUDA_INCLUDE_PATH})
include_directories(${MPI_INCLUDE_PATH})
include_directories(${NCCL_INCLUDE_PATH})
include_directories(./include)
aux_source_directory(./src SOURCE_FILE)
add_executable(test test.cu ${SOURCE_FILE})
find_package(MPI REQUIRED)
find_package(CUDA REQUIRED)
find_package(Nccl REQUIRED)
target_link_libraries(test ${MPI_C_LIBRARIES})
target_link_libraries(test ${CUDA_LIBRARIES})
target_link_libraries(test ${NCCL_LIBRARIES}/libnccl.so)
target_link_libraries(test curand)
target_link_libraries(test cublas)